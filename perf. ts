import { defineConfig } from '@playwright/test';

const soakIterationsRaw = process.env.SOAK_ITERATIONS ?? '50';
const soakIterations = Number.parseInt(soakIterationsRaw, 10);

export default defineConfig({
  projects: [
    {
      name: 'soak',
      grep: /@soak/,
      metadata: { soakIterations },
    },
    {
      name: 'benchmark',
      grep: /@benchmark/,
    }
  ]
});

import { test, expect } from '@playwright/test';

test('@soak flow', async ({ page }, testInfo) => {
  const raw = testInfo.project.metadata.soakIterations;
  const iterations = Number.isFinite(raw) && raw > 0 ? raw : 1;

  for (let i = 1; i <= iterations; i++) {
    testInfo.annotations.push({ type: 'iteration', description: `${i}/${iterations}` });

    await page.goto('https://example.com');
    await expect(page).toHaveURL(/example/);
  }
});


