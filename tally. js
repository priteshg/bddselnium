const fs = require("fs");

// Load or initialise tally
let tally = {};
if (fs.existsSync("failure-tally.json")) {
  tally = JSON.parse(fs.readFileSync("failure-tally.json", "utf8"));
}

function addResult(testName, failed) {
  if (!tally[testName]) tally[testName] = { runs: 0, fails: 0 };
  tally[testName].runs++;
  if (failed) tally[testName].fails++;
}

/* -----------------------------------
   JEST â€” Format B
   [
     { "name": "...", "status": "passed" }
   ]
------------------------------------- */

if (fs.existsSync("jest-results.json")) {
  const jest = JSON.parse(fs.readFileSync("jest-results.json", "utf8"));

  if (Array.isArray(jest)) {
    jest.forEach(item => {
      if (item && item.name && item.status) {
        addResult(`JEST: ${item.name}`, item.status === "failed");
      }
    });
  }
}

/* -----------------------------------
   PLAYWRIGHT
------------------------------------- */

if (fs.existsSync("playwright-report.json")) {
  const pw = JSON.parse(fs.readFileSync("playwright-report.json", "utf8"));