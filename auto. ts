import { test as base } from 'playwright-bdd';
import type { GlobalRelayApp } from '../utils/setup';
import { loadGlobalRelayApp } from '../utils/setup';
import type { UserCredentials } from '../pages/login';
import { AppControl, Filters, Message, MessageList, Search, SearchCriteriaModal, GarageDoor } from '../pages';
import { MyArchive } from '../pages/myArchive';

type Fixtures = {
  credentials: UserCredentials;
  grApp: GlobalRelayApp;

  myArchive: MyArchive;
  filters: Filters;
  message: Message;
  messageList: MessageList;
  search: Search;
  searchCriteriaModal: SearchCriteriaModal;
  garageDoor: GarageDoor;
};

export const test = base.extend<Fixtures>({
  credentials: async ({}, use) => {
    await use({} as UserCredentials);
  },

  grApp: async ({ credentials }, use, testInfo) => {
    const grApp = await loadGlobalRelayApp(0, credentials, testInfo);
    await new AppControl(grApp.frame).selectMyArchive();

    await use(grApp);

    await grApp.electronApp.close();
  },

  myArchive: async ({ grApp }, use) => {
    await use(new MyArchive(grApp.frame));
  },
  filters: async ({ grApp }, use) => {
    await use(new Filters(grApp.frame));
  },
  message: async ({ grApp }, use) => {
    await use(new Message(grApp.frame));
  },
  messageList: async ({ grApp }, use) => {
    await use(new MessageList(grApp.frame));
  },
  search: async ({ grApp }, use) => {
    await use(new Search(grApp.frame));
  },
  searchCriteriaModal: async ({ grApp }, use) => {
    await use(new SearchCriteriaModal(grApp.frame));
  },
  garageDoor: async ({ grApp }, use) => {
    await use(new GarageDoor(grApp.frame));
  },
});